<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON and Client-Server Communication</title>
    <style>
      /* add a simple dark mode for the html file - my eyes hurt*/
      * {
        background-color: rgb(24, 24, 24);
      }
    </style>
    <script defer>
      // create income Obj constructor
      function income(name, amount, isRecurring) {
        this.name = name;
        this.amount = amount;
        this.isRecurring = isRecurring;
      }

      // create 5 instances of income Obj
      let income1 = new income('Salary', 25000, true);
      let income2 = new income('Freelance', 5000, false);
      let income3 = new income('Investment', 1000, true);
      let income4 = new income('Crypto', 600, true);
      let income5 = new income('Garage sale', 1000, false);

      // Creat expense Obj constructor
      function expense(name, amount, isRecurring) {
        this.name = name;
        this.amount = amount;
        this.isRecurring = isRecurring;
      }

      // create 5 instances of income Obj
      let expense1 = new expense('Rent', 8000, true);
      let expense2 = new expense('Groceries', 5000, true);
      let expense3 = new expense('Utilities', 2000, true);
      let expense4 = new expense('Petrol', 2000, true);
      let expense5 = new expense('Entertainment', 2000, false);

      //place the objects inside an array for each type(income and expense)
      let incomes = [income1, income2, income3, income4, income5];
      let expenses = [expense1, expense2, expense3, expense4, expense5];

      //store the arrays (of objects) inside session storage(after converting them to JSON strings with .stringify since sessionstorage only accepts string data - when recalling the data we should always convert back from JSON with JSON.parse):
      sessionStorage.setItem('incomes', JSON.stringify(incomes));
      sessionStorage.setItem('expenses', JSON.stringify(expenses));

      //to simulate the scenario, lets call the expense and income data from session storage and use it in the following section of the assignment. This basically simulates "recalling" the users data from a previous session even though we just created the data ourselves and its essentially unchanged. we are now using session data to do the next part of the activity

      let recalledIncomes = JSON.parse(sessionStorage.getItem('incomes'));
      let recalledExpenses = JSON.parse(sessionStorage.getItem('expenses'));

      //create a function to ask the user for new income values and return the resulting object
      //==========================================
      function createNewIncome() {
        //prompt for the name of a new income item(and display the current income values pulled from sessionstorage)
        let newIncomeName = prompt(
          'Your income is as follows:\nSalary: +' +
            recalledIncomes[0].amount +
            '\nFreelance: +' +
            recalledIncomes[1].amount +
            '\nInvestment: +' +
            recalledIncomes[2].amount +
            '\nCrypto: +' +
            recalledIncomes[3].amount +
            '\nGarage sale: +' +
            recalledIncomes[4].amount +
            '\n' +
            'Please enter a name for another income item.'
        );

        //CHANGE: If the user cancels or leaves input empty (null), stop the function
        if (!newIncomeName) {
          // Explanation: `prompt()` returns `null` when the user presses cancel or leaves it empty. This check returns the function early to prevent further prompts.
          return; // Stops further execution of this function if input is invalid or canceled
        }

        //prompt for the amount of a new income item
        let newIncomeAmount = Number(
          prompt('Please enter an amount for the new income item.')
        );

        //CHANGE: Check for NaN (not a number) to ensure valid input
        if (isNaN(newIncomeAmount)) {
          alert(
            'Please only enter an integer into the amount, please refresh and try again.'
          );
          // Explanation: If the user enters non-numeric input, the function will stop by returning here.
          return; // Stops the function from proceeding
        }

        //prompt for the isRecurring boolean of a new income item
        let newIncomeIsRecurring = prompt(
          'Please enter yes or no to show if the income is recurring or not.'
        );

        //CHANGE: If user cancels the prompt or enters something besides yes/no, stop the function
        if (
          !newIncomeIsRecurring ||
          (newIncomeIsRecurring.toLowerCase() !== 'yes' &&
            newIncomeIsRecurring.toLowerCase() !== 'no')
        ) {
          alert(
            'Please only enter yes or no into the prompt box, please refresh the page and start again.'
          );
          // Explanation: Check for null (cancel) or invalid input. Return early to stop execution.
          return;
        }

        // Convert the string to a boolean with a ternary operator
        newIncomeIsRecurring = newIncomeIsRecurring.toLowerCase() === 'yes';

        //input the retrieved values into a new income object
        let income6 = new income(
          newIncomeName,
          newIncomeAmount,
          newIncomeIsRecurring
        );

        //return the final object
        return income6;
      }

      //create a function to ask the user for new expense values and return the resulting object
      //===================================================
      function createNewExpense() {
        //prompt for the name of a new Expense item(and display the current Expense values pulled from sessionstorage)
        let newExpenseName = prompt(
          'Your Expenses are as follows: \nRent: -' +
            recalledExpenses[0].amount +
            '\nGroceries: -' +
            recalledExpenses[1].amount +
            '\nUtilities: -' +
            recalledExpenses[2].amount +
            '\nPetrol: -' +
            recalledExpenses[3].amount +
            '\nEntertainment: -' +
            recalledExpenses[4].amount +
            '\n ' +
            'Please enter a name for another expense item.'
        );

        //CHANGE: If the user cancels or leaves input empty, stop the function
        if (!newExpenseName) {
          // Explanation: Same as the income name prompt, returning here stops further prompts if input is invalid or canceled.
          return;
        }

        //prompt for the amount of a new Expense item
        let newExpenseAmount = Number(
          prompt('Please enter an amount for the new Expense item.')
        );

        //CHANGE: Check if the input is NaN (non-numeric) and stop if so
        if (isNaN(newExpenseAmount)) {
          alert(
            'Please only enter an integer into the amount, please refresh and try again.'
          );
          // Explanation: Ensures valid numeric input and stops the function if incorrect input is given.
          return;
        }

        //prompt for the isRecurring boolean of a new Expense item
        let newExpenseIsRecurring = prompt(
          'Please enter yes or no to show if the Expense is recurring or not.'
        );

        //CHANGE: Check for null (cancel) or invalid input ('yes'/'no' only)
        if (
          !newExpenseIsRecurring ||
          (newExpenseIsRecurring.toLowerCase() !== 'yes' &&
            newExpenseIsRecurring.toLowerCase() !== 'no')
        ) {
          alert(
            'Please only enter yes or no into the prompt box, please refresh the page and start again.'
          );
          // Explanation: Stops execution if invalid input or cancel happens.
          return;
        }

        // Convert the string to a boolean with a ternary operator
        newExpenseIsRecurring = newExpenseIsRecurring.toLowerCase() === 'yes';

        //input the retrieved values into a new Expense object
        let expense6 = new expense(
          newExpenseName,
          newExpenseAmount,
          newExpenseIsRecurring
        );

        //return the final object
        return expense6;
      }

      function processNewEntries() {
        let newIncome = createNewIncome();
        if (newIncome === undefined) {
          //CHANGE: Stop the function if new income creation failed
          alert('Invalid input. Program stopped.');
          return;
        }

        let newExpense = createNewExpense();
        if (newExpense === undefined) {
          //CHANGE: Stop the function if new expense creation failed
          alert('Invalid input. Program stopped.');
          return;
        }

        recalledIncomes[5] = newIncome;
        recalledExpenses[5] = newExpense;

        sessionStorage.setItem('incomes', JSON.stringify(recalledIncomes));
        sessionStorage.setItem('expenses', JSON.stringify(recalledExpenses));
      }

      function calculateTotals() {
        let totalIncome = 0;
        let totalExpenses = 0;

        for (const item of recalledIncomes) {
          totalIncome += item.amount;
        }
        for (const item of recalledExpenses) {
          totalExpenses += item.amount;
        }

        let disposableIncome = totalIncome - totalExpenses;

        alert('Your total disposable income is: ' + disposableIncome);
      }

      processNewEntries();
      calculateTotals();
    </script>
  </head>
  <body></body>
</html>
